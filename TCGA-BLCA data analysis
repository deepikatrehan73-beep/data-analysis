# Pipeline: TCGA-BLCA Transcriptomic Normalization and Hub Gene Identification
# Author: Deepika Trehan
# Description: Automated workflow for data acquisition, DESeq2 normalization, 
#              and visualization of differentially expressed genes (DEGs).


# 1. Environment Setup
if (!require("BiocManager", quietly = TRUE)) install.packages("BiocManager")
BiocManager::install(c("TCGAbiolinks", "DESeq2", "EnhancedVolcano", "SummarizedExperiment"))

library(TCGAbiolinks)
library(DESeq2)
library(EnhancedVolcano)

# 2. Data Acquisition
# Accessing Bladder Urothelial Carcinoma (BLCA) Harmonized Data [cite: 1, 1338]
query <- GDCquery(
    project = "TCGA-BLCA",
    data.category = "Transcriptome Profiling",
    data.type = "Gene Expression Quantification",
    workflow.type = "STAR - Counts"
)
GDCdownload(query)
data <- GDCprepare(query)

# 3. Differential Expression Analysis (DESeq2)
# Mimicking experimental knockdown by comparing tumor stages [cite: 1, 213, 1489]
dds <- DESeqDataSet(data, design = ~ ajcc_pathologic_stage)

# Filtering low-count genes to improve statistical power
keep <- rowSums(counts(dds)) >= 10
dds <- dds[keep,]

# Execute normalization and differential expression
dds <- DESeq(dds)
res <- results(dds)

# Apply Log Fold Change (LFC) shrinkage for accurate visualization
resLFC <- lfcShrink(dds, coef=2, type="apeglm")

# 4. Visualization: Volcano Plot
# Highlighting key hub genes like VEGFA, CXCL8, and TP53 [cite: 1, 224, 1624]

EnhancedVolcano(resLFC,
    lab = rownames(resLFC),
    x = 'log2FoldChange',
    y = 'padj',
    title = 'Differential Expression in Bladder Cancer (TCGA-BLCA)',
    subtitle = 'Log2 Fold Change vs Adjusted P-Value',
    pCutoff = 0.05,
    FCcutoff = 1.0, 
    pointSize = 3.0,
    labSize = 5.0,
    col=c('grey', 'orange', 'blue', 'red')
)

# 5. Exporting Significant Gene List for Systems Biology Analysis
# Filter for significant DEGs (FDR < 0.05, |log2FC| > 1) [cite: 1, 98, 1517]
sig_genes <- subset(resLFC, padj < 0.05 & abs(log2FoldChange) > 1)
write.csv(as.data.frame(sig_genes), "TCGA_BLCA_Significant_DEGs.csv")

# NOTE: This list serves as the input for Cytoscape (MCODE) and CIBERSORT-X 
# deconvolution workflows as described in Trehan et al. (2023) [cite: 1, 79, 1346].
